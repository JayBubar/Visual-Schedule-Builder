<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Storage Reset - Visual Schedule Builder</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .warning {
            background: rgba(255, 69, 58, 0.2);
            border: 2px solid #ff453a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .info-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            min-width: 200px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        .button.safe {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }
        .button.safe:hover {
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }
        .results {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        .step {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4ecdc4;
        }
        .storage-keys {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .key-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.exists { background: #ff453a; }
        .status.missing { background: #30d158; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Complete Storage Reset Tool</h1>
        
        <div class="warning">
            <h2>‚ö†Ô∏è WARNING: COMPLETE DATA WIPE ‚ö†Ô∏è</h2>
            <p>This tool will permanently delete ALL Visual Schedule Builder data from both development and production versions.</p>
            <p>This includes all students, staff, activities, schedules, and settings.</p>
            <p><strong>This action cannot be undone!</strong></p>
        </div>

        <div class="step">
            <h3>Step 1: Analyze Current Storage</h3>
            <p>First, let's see what data currently exists in storage:</p>
            <button class="button safe" onclick="analyzeStorage()">üìä Analyze Current Storage</button>
        </div>

        <div class="step">
            <h3>Step 2: Complete Storage Cleanup</h3>
            <p>This will remove ALL Visual Schedule Builder data:</p>
            <button class="button" onclick="completeReset()" id="resetBtn" disabled>üî• COMPLETE RESET (No Undo!)</button>
        </div>

        <div class="step">
            <h3>Step 3: Create Fresh Demo Data</h3>
            <p>After reset, populate with fresh demo data:</p>
            <button class="button safe" onclick="createDemoData()" id="demoBtn" disabled>üéØ Create Fresh Demo Data</button>
        </div>

        <div class="step">
            <h3>Step 4: Verify Clean State</h3>
            <p>Verify everything is working correctly:</p>
            <button class="button safe" onclick="verifyReset()" id="verifyBtn" disabled>‚úÖ Verify Reset Success</button>
        </div>

        <div class="results" id="results">Ready to begin storage analysis...</div>
    </div>

    <script>
        // All known Visual Schedule Builder storage keys
        const VSB_STORAGE_KEYS = [
            'vsb_students',
            'vsb_staff', 
            'vsb_activities',
            'saved_schedules',
            'scheduleVariations',
            'activityLibrary',
            'students',
            'staff',
            'vsb_settings',
            'choiceRotationHistory',
            'choiceAnalytics',
            'dailyCheckInData',
            'behaviorCommitments',
            'dailyHighlights',
            'currentSchedule',
            'scheduleSettings',
            'userPreferences',
            'activityGoalMappings',
            'groupingHistory',
            'transitionActivities',
            'weatherSettings',
            'celebrationSettings',
            'audioSettings',
            'displaySettings',
            'smartboardSettings',
            'accessibility_settings',
            'theme_settings',
            'backup_',
            'temp_',
            'cache_',
            'debug_'
        ];

        let analysisComplete = false;

        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        function analyzeStorage() {
            log('üîç Starting comprehensive storage analysis...');
            
            let totalSize = 0;
            let foundKeys = [];
            let missingKeys = [];
            
            // Check each known key
            VSB_STORAGE_KEYS.forEach(key => {
                const value = localStorage.getItem(key);
                if (value !== null) {
                    const size = new Blob([value]).size;
                    totalSize += size;
                    foundKeys.push({
                        key: key,
                        size: size,
                        sizeKB: (size / 1024).toFixed(2),
                        preview: value.length > 100 ? value.substring(0, 100) + '...' : value
                    });
                } else {
                    missingKeys.push(key);
                }
            });

            // Check for any additional keys that might exist
            let additionalKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && !VSB_STORAGE_KEYS.some(vsbKey => key.includes(vsbKey))) {
                    const value = localStorage.getItem(key);
                    if (value) {
                        const size = new Blob([value]).size;
                        additionalKeys.push({
                            key: key,
                            size: size,
                            sizeKB: (size / 1024).toFixed(2)
                        });
                    }
                }
            }

            log(`üìä STORAGE ANALYSIS COMPLETE`);
            log(`Total localStorage keys: ${localStorage.length}`);
            log(`VSB keys found: ${foundKeys.length}`);
            log(`VSB keys missing: ${missingKeys.length}`);
            log(`Additional keys: ${additionalKeys.length}`);
            log(`Total VSB data size: ${(totalSize / 1024).toFixed(2)} KB`);
            log('');

            if (foundKeys.length > 0) {
                log(`üóÉÔ∏è EXISTING VSB DATA FOUND:`);
                foundKeys.forEach(item => {
                    log(`  ‚Ä¢ ${item.key}: ${item.sizeKB} KB`);
                });
                log('');
            }

            if (additionalKeys.length > 0) {
                log(`üîç ADDITIONAL KEYS FOUND:`);
                additionalKeys.forEach(item => {
                    log(`  ‚Ä¢ ${item.key}: ${item.sizeKB} KB`);
                });
                log('');
            }

            log(`‚ö†Ô∏è CONFLICT DETECTED: Found ${foundKeys.length} VSB storage keys`);
            log(`This confirms the storage conflict between dev and production versions.`);
            log('');
            log(`‚úÖ Analysis complete. Ready for reset.`);

            analysisComplete = true;
            document.getElementById('resetBtn').disabled = false;
        }

        function completeReset() {
            if (!analysisComplete) {
                log('‚ùå Please run analysis first!');
                return;
            }

            const confirmation = confirm(
                'üö® FINAL WARNING üö®\n\n' +
                'This will permanently delete ALL Visual Schedule Builder data.\n' +
                'This action CANNOT be undone.\n\n' +
                'Are you absolutely sure you want to proceed?'
            );

            if (!confirmation) {
                log('‚ùå Reset cancelled by user.');
                return;
            }

            log('üî• STARTING COMPLETE STORAGE RESET...');
            log('');

            let deletedCount = 0;
            let totalFreed = 0;

            // Delete all VSB-related keys
            VSB_STORAGE_KEYS.forEach(key => {
                const value = localStorage.getItem(key);
                if (value !== null) {
                    const size = new Blob([value]).size;
                    localStorage.removeItem(key);
                    totalFreed += size;
                    deletedCount++;
                    log(`üóëÔ∏è Deleted: ${key} (${(size / 1024).toFixed(2)} KB)`);
                }
            });

            // Also remove any keys that start with common prefixes
            const prefixesToClean = ['vsb_', 'backup_', 'temp_', 'cache_', 'debug_'];
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key && prefixesToClean.some(prefix => key.startsWith(prefix))) {
                    const value = localStorage.getItem(key);
                    if (value) {
                        const size = new Blob([value]).size;
                        localStorage.removeItem(key);
                        totalFreed += size;
                        deletedCount++;
                        log(`üóëÔ∏è Deleted prefix match: ${key} (${(size / 1024).toFixed(2)} KB)`);
                    }
                }
            }

            log('');
            log(`‚úÖ RESET COMPLETE!`);
            log(`üìä Deleted ${deletedCount} storage keys`);
            log(`üíΩ Freed ${(totalFreed / 1024).toFixed(2)} KB of storage`);
            log(`üßπ localStorage is now clean of all VSB data`);
            log('');
            log(`üéØ Ready to create fresh demo data...`);

            document.getElementById('demoBtn').disabled = false;
        }

        function createDemoData() {
            log('üéØ Creating fresh demo data...');
            log('');

            // Fresh demo teachers
            const demoTeachers = [
                {
                    id: 'teacher-1',
                    name: 'Ms. Sarah Johnson',
                    role: 'Lead Teacher',
                    email: 'sarah.johnson@school.edu',
                    phone: '555-0101',
                    certifications: ['Special Education', 'Autism Specialist'],
                    created: new Date().toISOString()
                },
                {
                    id: 'teacher-2', 
                    name: 'Mr. David Chen',
                    role: 'Assistant Teacher',
                    email: 'david.chen@school.edu',
                    phone: '555-0102',
                    certifications: ['Paraprofessional', 'Behavioral Support'],
                    created: new Date().toISOString()
                },
                {
                    id: 'teacher-3',
                    name: 'Ms. Emily Rodriguez',
                    role: 'Speech Therapist',
                    email: 'emily.rodriguez@school.edu', 
                    phone: '555-0103',
                    certifications: ['Speech-Language Pathology', 'AAC Specialist'],
                    created: new Date().toISOString()
                }
            ];

            // Fresh demo students
            const demoStudents = [
                {
                    id: 'student-1',
                    name: 'Alex Thompson',
                    age: 8,
                    grade: '2nd Grade',
                    needsLevel: 'High Support',
                    communicationMethod: 'PECS + Verbal',
                    interests: ['Trains', 'Music', 'Art'],
                    goals: ['Increase verbal communication', 'Follow 3-step directions'],
                    created: new Date().toISOString()
                },
                {
                    id: 'student-2',
                    name: 'Maya Patel', 
                    age: 10,
                    grade: '4th Grade', 
                    needsLevel: 'Moderate Support',
                    communicationMethod: 'AAC Device + Verbal',
                    interests: ['Reading', 'Animals', 'Puzzles'],
                    goals: ['Improve social interactions', 'Complete independent tasks'],
                    created: new Date().toISOString()
                },
                {
                    id: 'student-3',
                    name: 'Jordan Williams',
                    age: 7,
                    grade: '1st Grade',
                    needsLevel: 'High Support', 
                    communicationMethod: 'Gestures + Emerging Verbal',
                    interests: ['Sensory toys', 'Movement', 'Colors'],
                    goals: ['Increase attention span', 'Reduce transition anxiety'],
                    created: new Date().toISOString()
                },
                {
                    id: 'student-4',
                    name: 'Sam Kumar',
                    age: 9,
                    grade: '3rd Grade',
                    needsLevel: 'Low Support',
                    communicationMethod: 'Fully Verbal',
                    interests: ['Math', 'Technology', 'Building'],
                    goals: ['Improve executive function', 'Develop peer relationships'],
                    created: new Date().toISOString()
                }
            ];

            // Fresh activity library
            const demoActivities = [
                {
                    id: 'activity-1',
                    name: 'Morning Circle',
                    category: 'Group Activity',
                    description: 'Daily greeting and calendar time',
                    duration: 15,
                    materials: ['Calendar', 'Weather chart', 'Greeting songs'],
                    instructions: 'Gather in circle, greet each student, review calendar and weather',
                    goals: ['Social interaction', 'Routine following', 'Communication']
                },
                {
                    id: 'activity-2',
                    name: 'Math Centers',
                    category: 'Academic',
                    description: 'Rotational math activities',
                    duration: 30,
                    materials: ['Manipulatives', 'Worksheets', 'iPad apps'],
                    instructions: 'Students rotate through 3 centers with different math concepts',
                    goals: ['Number recognition', 'Counting skills', 'Problem solving']
                },
                {
                    id: 'activity-3',
                    name: 'Sensory Break',
                    category: 'Break',
                    description: 'Calming sensory activities',
                    duration: 10,
                    materials: ['Sensory bin', 'Weighted blankets', 'Fidget toys'],
                    instructions: 'Students choose preferred sensory activity for self-regulation',
                    goals: ['Self-regulation', 'Sensory processing', 'Calm body']
                },
                {
                    id: 'activity-4',
                    name: 'Reading Groups',
                    category: 'Academic',
                    description: 'Small group literacy instruction',
                    duration: 25,
                    materials: ['Leveled books', 'Picture cards', 'Letter tiles'],
                    instructions: 'Small groups work on individualized reading skills',
                    goals: ['Reading comprehension', 'Phonics', 'Vocabulary']
                },
                {
                    id: 'activity-5',
                    name: 'Art Therapy',
                    category: 'Therapy',
                    description: 'Creative expression through art',
                    duration: 30,
                    materials: ['Art supplies', 'Adaptive tools', 'Visual guides'],
                    instructions: 'Students create art while working on fine motor and expression goals',
                    goals: ['Fine motor skills', 'Creative expression', 'Following directions']
                }
            ];

            // Save all fresh data
            localStorage.setItem('vsb_staff', JSON.stringify(demoTeachers));
            localStorage.setItem('vsb_students', JSON.stringify(demoStudents));
            localStorage.setItem('activityLibrary', JSON.stringify(demoActivities));

            // Also save in alternate key formats for compatibility
            localStorage.setItem('staff', JSON.stringify(demoTeachers));
            localStorage.setItem('students', JSON.stringify(demoStudents));

            // Create basic settings
            const settings = {
                theme: 'light',
                accessibility: {
                    highContrast: false,
                    largeText: false,
                    reducedMotion: false
                },
                smartboard: {
                    autoAdvance: false,
                    showTimer: true,
                    soundEffects: true
                },
                created: new Date().toISOString()
            };
            localStorage.setItem('vsb_settings', JSON.stringify(settings));

            log(`‚úÖ Created ${demoTeachers.length} demo teachers`);
            log(`‚úÖ Created ${demoStudents.length} demo students`);
            log(`‚úÖ Created ${demoActivities.length} demo activities`);
            log(`‚úÖ Created default settings`);
            log('');
            log(`üéâ FRESH DEMO DATA CREATION COMPLETE!`);
            log('');

            // Log the created data for verification
            log(`üë®‚Äçüè´ Demo Teachers:`);
            demoTeachers.forEach(teacher => {
                log(`  ‚Ä¢ ${teacher.name} (${teacher.role})`);
            });
            log('');

            log(`üë¶üëß Demo Students:`);
            demoStudents.forEach(student => {
                log(`  ‚Ä¢ ${student.name} - ${student.grade} (${student.needsLevel})`);
            });
            log('');

            log(`üéØ Ready for verification...`);
            document.getElementById('verifyBtn').disabled = false;
        }

        function verifyReset() {
            log('‚úÖ Verifying reset and fresh data...');
            log('');

            // Verify clean state
            let vsbKeysFound = 0;
            VSB_STORAGE_KEYS.forEach(key => {
                if (localStorage.getItem(key) !== null) {
                    vsbKeysFound++;
                }
            });

            // Check for our new data
            const staff = JSON.parse(localStorage.getItem('vsb_staff') || '[]');
            const students = JSON.parse(localStorage.getItem('vsb_students') || '[]');
            const activities = JSON.parse(localStorage.getItem('activityLibrary') || '[]');
            const settings = JSON.parse(localStorage.getItem('vsb_settings') || '{}');

            log(`üìä VERIFICATION RESULTS:`);
            log(`VSB storage keys present: ${vsbKeysFound}`);
            log(`Staff members loaded: ${staff.length}`);
            log(`Students loaded: ${students.length}`);
            log(`Activities loaded: ${activities.length}`);
            log(`Settings loaded: ${Object.keys(settings).length > 0 ? 'Yes' : 'No'}`);
            log('');

            if (staff.length > 0 && students.length > 0 && activities.length > 0) {
                log(`‚úÖ SUCCESS: Fresh demo data is properly loaded!`);
                log(`üéØ Your development environment now has clean, fresh data.`);
                log(`üì± The app should now show the correct demo data.`);
                log('');
                log(`üöÄ COMPLETE STORAGE RESET SUCCESSFUL!`);
                log(`Now restart your development server to see the changes.`);
            } else {
                log(`‚ùå ERROR: Missing demo data detected!`);
                log(`Staff: ${staff.length}, Students: ${students.length}, Activities: ${activities.length}`);
                log(`Try running the demo data creation step again.`);
            }
        }
    </script>
</body>
</html>
